{% load static %}

<div class="navbar navbar-light" style="background-color: #6a0dad;">
    <button class="navbar-button" id="logoBtn"> 
        <img src="{% static 'pong/pong_logo.png' %}" alt="Logo" class="logo">
    </button>
      <div>
          <button class="navbar-button" id="gameBtn">Play</button>
          <button class="navbar-button" id="profileBtn" data-username="{{ user.username }}">Dashboard</button>
        </div>

        <div>
            <button class="navbar-button" id="logoutBtn">Logout</button>
        </div>
    </div>

    <script>
        document.getElementById('logoBtn').addEventListener('click', function(event) {
            event.preventDefault();
        console.log('Logo button clicked');
        });
      document.querySelector('.navbar').addEventListener('click', function(event) {
        const target = event.target;
        if (target.matches('.navbar-button')) {
            event.preventDefault();
            console.log(target.textContent + ' button clicked');
            switch (target.id) {
                case 'gameBtn':
                    //document.getElementById("content").innerHTML = '';
                    fetch("/lobby")
                        .then(response => response.text())
                        .then(html => {
                            document.getElementById("content").innerHTML = html;
                            executeJavaScriptInContent(html);
                          })
                        .catch(error => console.error('Error loading game page:', error));
                    break;
                case 'profileBtn':
                const username =  this.dataset.username; // Retrieve username from data attribute
            console.log(username);
            const url = `/profile/{{ user.username }}/`; // Construct the URL with the username
            fetch(url)
                        .then(response => response.text())
                        .then(html => {
                            document.getElementById("content").innerHTML = html;
                            executeJavaScriptInContent(html);
                          })
                        .catch(error => console.error('Error loading profile page:', error));
                    break;
                case 'logoutBtn':
                    fetch("{% url 'userManagement:logout' %}", {
                            method: "POST",
                            headers: {
                                "X-CSRFToken": getCookie("csrftoken")
                            }
                        })
                        .then(response => {
                            if (response.ok) {
                                document.getElementById("navbar").innerHTML = '';
                                document.getElementById("content").innerHTML = '';
                                fetch("/stranger")
                                    .then(response => response.text())
                                    .then(html => {
                                        document.getElementById("content").innerHTML = html;
                                        executeJavaScriptInContent(html);
                                      })
                                    .catch(error => console.error('Error loading content:', error));
                            } else {
                                console.error("Logout failed");
                            }
                        })
                        .catch(error => console.error('Error:', error));
                    break;
            }
        }
    });
    function executeJavaScriptInContent(html) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const scriptElements = doc.querySelectorAll('script');
        //console.log(scriptElements[0].textContent);
        //console.log(scriptElements[1].textContent);
        //eval(scriptElements[1].textContent)
        scriptElements.forEach(script => {
             eval(script.textContent);
        });
    }
          // Function to retrieve CSRF token from cookies
          function getCookie(name) {
              let cookieValue = null;
              if (document.cookie && document.cookie !== '') {
                  const cookies = document.cookie.split(';');
                  for (let i = 0; i < cookies.length; i++) {
                      const cookie = cookies[i].trim();
                      // Does this cookie string begin with the name we want?
                      if (cookie.substring(0, name.length + 1) === (name + '=')) {
                          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                          break;
                      }
                  }
              }
              return cookieValue;
          }
      </script>
