{% load static %}

<div class="navbar navbar-light" style="background-color: #6a0dad;">
    <button class="navbar-button" id="logoBtn"> 
        <img src="{% static 'pong/pong_logo.png' %}" alt="Logo" class="logo">
    </button>
      <div>
          <button class="navbar-button" id="gameBtn">Play</button>
          <button class="navbar-button" id="profileBtn" data-username="{{ user.username }}">Dashboard</button>
        </div>

        <div>
            <button class="navbar-button" id="logoutBtn">Logout</button>
        </div>
    </div>

	

    <script type="module">
		import {fetch_html_replace_dynamicDIV_activate_js, fetch_marie} from "../../static/pong_online/landing_test.js";

        document.getElementById('logoBtn').addEventListener('click', function(event) {
        event.preventDefault();
        console.log('Logo button clicked');
        document.getElementById("content").innerHTML = '';
        fetch("/logged_in")
                        .then(response => response.text())
                        .then(html => {
                            document.getElementById("content").innerHTML = html;
                            executeJavaScriptInContent(html);
                          })
                        .catch(error => console.error('Error loading landing page:', error));
                    
            });
      document.querySelector('.navbar').addEventListener('click', function(event) {
        const target = event.target;
        if (target.matches('.navbar-button')) {
            event.preventDefault();
            console.log(target.textContent + ' button clicked');
            switch (target.id) {
                case 'gameBtn':
					fetch_html_replace_dynamicDIV_activate_js('/lobby', true);
                    break;
                case 'profileBtn':
                // const username =  this.dataset.username; // Retrieve username from data attribute
            		console.log(username);
            		const profile_url = `/profile/{{ user.username }}/`; // Construct the URL with the username
					fetch_marie(profile_url);
                    break;
                case 'logoutBtn':
                    fetch("{% url 'userManagement:logout' %}", {
                            method: "POST",
                            headers: {
                                "X-CSRFToken": getCookie("csrftoken")
                            }
                        })
                        .then(response => {
                            if (response.ok) {
                                document.getElementById("navbar").innerHTML = '';
                                document.getElementById("content").innerHTML = '';
                                fetch("/stranger")
                                    .then(response => response.text())
                                    .then(html => {
                                        document.getElementById("content").innerHTML = html;
                                        executeJavaScriptInContent(html);
                                      })
                                    .catch(error => console.error('Error loading content:', error));
                            } else {
                                console.error("Logout failed");
                            }
                        })
                        .catch(error => console.error('Error:', error));
                    break;
            }
        }
    });

          // Function to retrieve CSRF token from cookies
          function getCookie(name) {
              let cookieValue = null;
              if (document.cookie && document.cookie !== '') {
                  const cookies = document.cookie.split(';');
                  for (let i = 0; i < cookies.length; i++) {
                      const cookie = cookies[i].trim();
                      // Does this cookie string begin with the name we want?
                      if (cookie.substring(0, name.length + 1) === (name + '=')) {
                          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                          break;
                      }
                  }
              }
              return cookieValue;
          }
      </script>
