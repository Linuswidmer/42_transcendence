{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Pong{% endblock %}</title>
    <!-- Add your CSS and JavaScript links here -->
    {% block styles %}
        <link rel="stylesheet" href="{% static 'pong/styles.css' %}">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="{% static 'userManagement/styles.css' %}">
    {% endblock %}

</head>
<body>
  <div id="all">
      <div id="content">
          {% if user.is_authenticated %}
          <div id="navbar">
              <div class="navbar navbar-light" style="background-color: #6a0dad;">
                <button class="navbar-button" id="logoBtn">
                    <img src="{% static 'pong/pong_logo.png' %}" alt="Logo" class="logo">
                </button>
                <div>
                    <button class="navbar-button" id="gameBtn">Play</button>
                    <button class="navbar-button" id="profileBtn">Dashboard</button>
                </div>
                <div>
                    <button class="navbar-button" id="logoutBtn">Logout</button>
                </div>
            </div>
        </div>
        {% endif %}
        {% block content %}
    {% endblock content %}
  </div>
</div>
<script src="{% static 'pong/history.js' %}"></script>
{% if user.is_authenticated %}
<script>
document.getElementById('logoBtn').addEventListener('click', function(event) {
    event.preventDefault();
    fetch("/logged_in")
    .then(response => response.text())
    .then(html => {
        document.getElementById("all").innerHTML = html;
        executeJavaScriptInContent(html);
    })
    .catch(error => console.error('Error loading game page:', error));
    history.pushState(null, null, "/logged_in");
});

document.getElementById('navbar').addEventListener('click', function(event) {
    const target = event.target;
    if (target.matches('.navbar-button')) {
        event.preventDefault();
        console.log(target.id);
        switch (target.id) {
        case 'gameBtn':
            loadContent("/lobby");
            history.pushState(null, null, "/lobby");
            break;
        case 'profileBtn':
            const url = `/profile/{{ request.user }}/`
            loadContent(url);
            history.pushState(null, null, url);
            break;
        case 'logoutBtn':
            fetch("{% url 'userManagement:logout' %}", {
                method: "POST",
                headers: {
                "X-CSRFToken": getCookie('csrftoken')
                }
            })
            .then(response => {
                if (response.ok) {
                    document.getElementById("navbar").innerHTML = '';
                    document.getElementById("content").innerHTML = '';
                    loadContent("/stranger")
                    history.pushState(null, null, "/stranger");
                } else {
                    console.error("Logout failed");
                }
            })
            .catch(error => console.error('Error:', error));
            history.pushState(null, null, "/stranger");
            break;
        }
    }
});
</script>
{% endif %}
{% include 'includes/footer.html' %}

    {% block extra_scripts %}
    {% endblock extra_scripts %}
    </body>
</html>
